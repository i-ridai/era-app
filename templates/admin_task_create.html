<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Era - タスク生成</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    :root {
      --bs-primary: #007BFF;
      --bs-light-gray: #f8f9fa;
    }
    body {
      background-color: var(--bs-light-gray);
      padding-top: 70px;
    }
    .navbar {
      box-shadow: 0 2px 4px rgba(0,0,0,.05);
    }
    .form-wrapper {
        background-color: #fff;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,.06);
        border: 1px solid #dee2e6;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="/admin">Era 管理</a>
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="/admin">ダッシュボード</a></li>
        <li class="nav-item"><a class="nav-link active" href="/admin/task-create">タスク生成</a></li>
        <li class="nav-item"><a class="nav-link" href="/admin/task-view">タスク一覧</a></li>
      </ul>
    </div>
  </nav>

  <main class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-8">
            <div class="form-wrapper">
                <h1 class="h4 mb-4 text-center">新しいタスクの作成</h1>
                <form id="taskForm" class="row g-3">
                  <div class="col-12">
                    <label class="form-label">タスク名称</label>
                    <input class="form-control" id="title" required />
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">タスク種類</label>
                    <select class="form-select" id="type">
                      <option>木工事</option><option>配管</option><option>電気</option><option>内装</option><option>外構</option>
                    </select>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">担当者</label>
                    <select class="form-select" id="assignee">
                      <option>菊池</option><option>佐藤</option><option>田中</option><option>鈴木</option><option>高橋</option>
                    </select>
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">開始予定日</label>
                    <input type="date" class="form-control" id="startPlanned" required />
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">完了予定日</label>
                    <input type="date" class="form-control" id="endPlanned" required />
                  </div>
                  
                  <div class="col-md-6">
                    <label class="form-label">開始実績日</label>
                    <input type="date" class="form-control" id="startActual" />
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">完了実績日</label>
                    <input type="date" class="form-control" id="endActual" />
                  </div>

                  <div class="col-md-6">
                    <label class="form-label">ステータス</label>
                    <select class="form-select" id="status">
                      <option>未着手</option><option>進行中</option><option>完了</option>
                    </select>
                  </div>

                  <div class="col-12">
                    <label class="form-label">備考</label>
                    <textarea class="form-control" id="remarks" rows="3" placeholder="タスクに関する詳細や注意事項を記入..."></textarea>
                  </div>

                  <div class="col-12 d-flex justify-content-end gap-2 mt-4">
                    <a class="btn btn-outline-secondary" href="/admin/task-view">キャンセル</a>
                    <button class="btn btn-primary" type="submit">保存して一覧へ</button>
                  </div>
                </form>
            </div>
        </div>
    </div>
  </main>

  <script>
  const LS_KEY = "era_tasks_v1";
  function normalize(list){
    return (list||[]).map((t,i)=>{
      const id = t.id ?? Date.now()+i;
      const title = t.title ?? t.name ?? "";
      return {
        id, title,
        type: t.type ?? t.workType ?? "",
        assignee: t.assignee ?? "",
        startPlanned: t.startPlanned ?? t.start ?? "",
        startActual: t.startActual ?? "",
        endPlanned: t.endPlanned ?? t.end ?? "",
        endActual: t.endActual ?? "",
        status: t.status ?? "未着手",
        remarks: t.remarks ?? t.notes ?? "",
        progress: typeof t.progress==="number" ? t.progress : 0,
        tags: t.tags || []
      };
    });
  }
  function loadTasks(){ try{ const raw=localStorage.getItem(LS_KEY); return raw? normalize(JSON.parse(raw)) : []; }catch(e){ return []; } }
  function saveTasks(list){ localStorage.setItem(LS_KEY, JSON.stringify(list)); }

  document.getElementById("taskForm").addEventListener("submit", (e)=>{
    e.preventDefault();
    const tasks = loadTasks();
    const data = {
      id: Date.now(),
      title: document.getElementById("title").value.trim(),
      type: document.getElementById("type").value,
      assignee: document.getElementById("assignee").value,
      startPlanned: document.getElementById("startPlanned").value,
      startActual: document.getElementById("startActual").value,
      endPlanned: document.getElementById("endPlanned").value,
      endActual: document.getElementById("endActual").value,
      status: document.getElementById("status").value,
      remarks: document.getElementById("remarks").value.trim(),
      progress: 0,
      tags: []
    };
    if (data.title && data.startPlanned && data.endPlanned) {
        tasks.push(data);
        saveTasks(tasks);
        location.href="/admin/task-view";
    } else {
        alert("必須項目をすべて入力してください。");
    }
  });
  </script>
</body>
</html>