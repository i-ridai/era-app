<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Era 管理者 - ダッシュボード</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root { --bs-primary:#00BFFF !important; }
    body { background:#fff; }
    .navbar-brand span{ width:.65rem;height:.65rem;border-radius:50%;display:inline-block;background:#00BFFF;margin-right:.5rem;vertical-align:middle;}
    .badge-tag { background:#e8f7ff; border:1px solid #bfe9ff; color:#086ea1; }
    .table thead th { white-space: nowrap; }
  </style>
  
</head>
<body>
<nav class="navbar navbar-expand-lg border-bottom mb-3">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/admin"><span></span>Era 管理</a>
    <div class="ms-auto d-flex gap-2">
      <a class="btn btn-outline-primary" href="/admin/task-create">タスク生成</a>
      <a class="btn btn-primary" href="/admin/task-view">タスク一覧</a>
    </div>
  </div>
</nav>
<div class="container pb-5">
<h1 class="mb-4">ダッシュボード</h1>
<p class="text-muted">ローカルストレージに保存されたタスクを集計して表示します。</p>
<div class="row g-3" id="metrics">
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body">
    <div class="text-muted small">タスク総数</div><div id="m_total" class="fs-3 fw-bold">0</div>
  </div></div></div>
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body">
    <div class="text-muted small">ToDo</div><div id="m_todo" class="fs-3 fw-bold">0</div>
  </div></div></div>
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body">
    <div class="text-muted small">進行中</div><div id="m_doing" class="fs-3 fw-bold">0</div>
  </div></div></div>
  <div class="col-md-3"><div class="card shadow-sm"><div class="card-body">
    <div class="text-muted small">完了</div><div id="m_done" class="fs-3 fw-bold">0</div>
  </div></div></div>
</div>

<h5 class="mt-4 mb-2">近日のタスク</h5>
<div class="table-responsive">
<table class="table table-hover align-middle">
  <thead class="table-light"><tr>
    <th>タスク名</th><th>担当</th><th>開始</th><th>期限</th><th>進捗</th><th>状態</th>
  </tr></thead>
  <tbody id="nearTable"></tbody>
</table>
</div>

<script>
const LS_KEY="era_tasks_v1";
function load(){ try{const r=localStorage.getItem(LS_KEY);return r?JSON.parse(r):[];}catch(e){return [];} }
function refresh(){
  const tasks=load();
  document.getElementById("m_total").textContent = tasks.length;
  document.getElementById("m_todo").textContent  = tasks.filter(t=>t.status==="ToDo").length;
  document.getElementById("m_doing").textContent = tasks.filter(t=>t.status==="進行中").length;
  document.getElementById("m_done").textContent  = tasks.filter(t=>t.status==="完了").length;
  const tbody = document.getElementById("nearTable"); tbody.innerHTML="";
  tasks.slice().sort((a,b)=>new Date(a.start)-new Date(b.start)).slice(0,10).forEach(t=>{
    const tr=document.createElement("tr");
    tr.innerHTML = `<td>${t.name}</td><td>${t.assignee||"-"}</td><td>${t.start}</td><td>${t.end}</td><td>${t.progress||0}%</td><td>${t.status}</td>`;
    tbody.appendChild(tr);
  });
}
refresh();
</script>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body></html>